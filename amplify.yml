version: 1
applications:
  - appRoot: frontend
    frontend:
      phases:
        preBuild:
          commands:
            - echo "Starting EmotioXV2 Frontend Build Process"
            - echo "Node version:" && node --version
            - echo "NPM version:" && npm --version
            - echo "Installing shared dependencies..."
            - cd ../shared && npm ci || echo "Shared dependencies not found, continuing..."
            - cd ../frontend
            - echo "Installing frontend dependencies..."
            - npm ci
            - echo "Linking shared package..."
            - npm install ../shared || echo "Shared package not available, continuing..."
            - echo "Dependencies installed successfully"
        build:
          commands:
            - echo "Starting build process..."
            - echo "Building the application..."
            - npm run build
            - echo "Build completed successfully!"
        postBuild:
          commands:
            - echo "Post-build cleanup..."
            - echo "Build artifacts generated in out/"
            - ls -la out/
            - ls -la out/
      artifacts:
        baseDirectory: out
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - ../node_modules/**/*
          - .next/cache/**/*
    customHeaders:
      - pattern: '**'
        headers:
          - key: 'X-Frame-Options'
            value: 'DENY'
          - key: 'X-Content-Type-Options'
            value: 'nosniff'
          - key: 'X-XSS-Protection'
            value: '1; mode=block'
          - key: 'Strict-Transport-Security'
            value: 'max-age=31536000; includeSubDomains'
          - key: 'Referrer-Policy'
            value: 'strict-origin-when-cross-origin'
      - pattern: '**/*.js'
        headers:
          - key: 'Cache-Control'
            value: 'public, max-age=31536000, immutable'
      - pattern: '**/*.css'
        headers:
          - key: 'Cache-Control'
            value: 'public, max-age=31536000, immutable'
      - pattern: '**/*.{png,jpg,jpeg,gif,webp,svg,ico}'
        headers:
          - key: 'Cache-Control'
            value: 'public, max-age=31536000, immutable'
      - pattern: '**/*.{woff,woff2,ttf,eot}'
        headers:
          - key: 'Cache-Control'
            value: 'public, max-age=31536000, immutable'
      - pattern: '*.html'
        headers:
          - key: 'Cache-Control'
            value: 'public, max-age=0, must-revalidate'
    rewrites:
      - source: '/<*>'
        target: '/index.html'
        status: '200'
    redirects:
      - source: '/index.html'
        target: '/'
        status: '301'
    environmentVariables:
      - name: NODE_ENV
        value: production
      - name: NEXT_TELEMETRY_DISABLED
        value: '1'
      - name: NODE_OPTIONS
        value: '--max-old-space-size=4096'
