# Definiciones de Funciones Lambda para serverless.yml

# Función principal para API REST - maneja todas las rutas
api:
  handler: src/index.handler
  events:
    # --- Rutas de Participantes ---
    - http:
        path: /participants/login
        method: POST
        cors: true
    - http:
        path: /participants
        method: POST
        cors: true
    - http:
        path: /participants
        method: GET
        cors: true
    - http:
        path: /participants/{id}
        method: GET
        cors: true
    - http:
        path: /participants/{id}
        method: DELETE
        cors: true

    # --- Rutas para Module Responses ---
    - http:
        path: /module-responses
        method: GET
        cors: true
    - http:
        path: /module-responses
        method: POST
        cors: true
    - http:
        path: /module-responses/{id}
        method: PUT
        cors: true
    - http:
        path: /module-responses/complete
        method: POST
        cors: true
    - http:
        path: /module-responses/research/{id}
        method: GET
        cors: true
    - http:
        path: /module-responses
        method: DELETE
        cors: true

    # Ruta específica para GET WelcomeScreen
    - http:
        path: /research/{researchId}/welcome-screen
        method: GET
        cors: true

    # Ruta específica para GET SmartVOC
    - http:
        path: /research/{researchId}/smart-voc
        method: GET
        cors: true

    # Añadir ruta explícita para PUT SmartVOC
    - http:
        path: /research/{researchId}/smart-voc
        method: PUT
        cors: true

    # Ruta específica para DELETE SmartVOC
    - http:
        path: /research/{researchId}/smart-voc
        method: DELETE
        cors: true

    # --- RUTA: Crear nueva investigación ---
    - http:
        path: /research
        method: POST
        cors: true

    # --- RUTA: Obtener todas las investigaciones ---
    - http:
        path: /research
        method: GET
        cors: true

    # --- NUEVA RUTA: Obtener formularios/pasos de una investigación ---
    - http:
        path: /research/{researchId}/forms
        method: GET
        cors: true

    # --- RUTA: Eliminar investigación por ID ---
    - http:
        path: /research/{researchId}
        method: DELETE
        cors: true

    # Ruta genérica para el resto
    - http:
        path: /{proxy+}
        method: ANY
        cors: true
    - http:
        path: /
        method: ANY
        cors: true

  environment:
    CONNECTION_TYPE: http

# Función para WebSockets
websocket:
  handler: src/index.handler
  events:
    - websocket:
        route: $connect
    - websocket:
        route: $disconnect
    - websocket:
        route: $default
    - websocket:
        route: message
  environment:
    CONNECTION_TYPE: websocket
